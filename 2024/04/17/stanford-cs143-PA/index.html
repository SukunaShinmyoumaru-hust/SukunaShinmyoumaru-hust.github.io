
  <!DOCTYPE html>
  <html lang="zh-CN"  >
  <head>
  <meta charset="utf-8">
  

  

  

  
  <script>window.REIMU_CONFIG = {};window.REIMU_CONFIG.icon_font = '4552607_tq6stt6tcg';window.REIMU_CONFIG.clipboard_tips = {"success":"复制成功(*^▽^*)","fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","copyright":{"enable":false,"count":50,"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！"}};</script>
  
  
  <title>
    Stanford CS143 PA |
    
    Suwa shrine
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  
    <meta name="description" content="词法分析flex用法flex可以用于词法分析。一个flex文件可以分成2个部分：引导区和规则区（我起的名） 引导区的内容会原封不动地放到.c文件中。规则区是由若干个规则组成的区域，flex的目的就是为了把规则区的内容进行解释，变成词法分析的.c文件中。（理论：正则表达式转化为NFA，然后再转化为DFA）。规则区的每一个规则由三部分组成&lt;执行状态&gt;&lt;正则式&gt;&lt;匹配规则&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Stanford CS143 PA">
<meta property="og:url" content="https://sukunashinmyoumaru-hust.github.io/2024/04/17/stanford-cs143-PA/index.html">
<meta property="og:site_name" content="Suwa shrine">
<meta property="og:description" content="词法分析flex用法flex可以用于词法分析。一个flex文件可以分成2个部分：引导区和规则区（我起的名） 引导区的内容会原封不动地放到.c文件中。规则区是由若干个规则组成的区域，flex的目的就是为了把规则区的内容进行解释，变成词法分析的.c文件中。（理论：正则表达式转化为NFA，然后再转化为DFA）。规则区的每一个规则由三部分组成&lt;执行状态&gt;&lt;正则式&gt;&lt;匹配规则&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-04-17T01:11:55.000Z">
<meta property="article:modified_time" content="2024-04-17T03:12:46.841Z">
<meta property="article:author" content="Sukuna">
<meta name="twitter:card" content="summary">
  
  
    <link rel="alternate" href="/atom.xml" title="Suwa shrine" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
    
  
  
  
  
    
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script>

  
  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css">

  
  
</head>

  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        
          <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
           M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)" />
          </svg>
        
      </div>
      <div class="loading-word">少女祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/">首页</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/archives">归档</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/about">关于</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/friend">友链</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://github.com/SukunaShinmyoumaru-hust/Hust-opensource-Xuejie">HUST-学解</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/picture">赠画感谢</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/source">资料下载</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/travel">旅行日志</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/gbook">Sukuna冬令营</a>
        </span>
      
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅" target="_blank"></a>
    
    
    
  </nav>
</div>
<header id="header">
  
    
      <img fetchpriority="high" src="/images/sukuna.png" alt="Stanford CS143 PA">
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">Stanford CS143 PA</h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content">
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">词法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flex%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">flex用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">1.2.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.3.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex%E7%BC%96%E8%AF%91%E5%87%BA%E6%9D%A5%E7%9A%84C%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">flex编译出来的C语言文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">语法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0%E4%B8%80%E4%B8%8B%EF%BC%81%E7%A7%BB%E8%BF%9B%E5%92%8C%E8%A7%84%E7%BA%A6"><span class="toc-number">2.1.</span> <span class="toc-text">复习一下！移进和规约</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%B3%95%E8%A7%84%E5%88%99"><span class="toc-number">2.2.</span> <span class="toc-text">文法规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.4.</span> <span class="toc-text">$$是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%84%E7%BA%A6%E5%86%B2%E7%AA%81%E7%9A%84%E5%8C%96%E8%A7%A3"><span class="toc-number">2.5.</span> <span class="toc-text">规约冲突的化解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%AE%9A%E4%B9%89%E7%9A%84%E6%96%87%E6%B3%95"><span class="toc-number">2.6.</span> <span class="toc-text">迭代定义的文法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%AD%E4%B9%89%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">语义分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%9A%84review"><span class="toc-number">3.1.</span> <span class="toc-text">前端的review</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E8%A1%A8"><span class="toc-number">3.2.</span> <span class="toc-text">类表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%A1%A8"><span class="toc-number">3.3.</span> <span class="toc-text">方法表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%A1%A8"><span class="toc-number">3.4.</span> <span class="toc-text">属性表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">3.5.</span> <span class="toc-text">表达式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-number">4.</span> <span class="toc-text">代码生成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%92%8C%E6%A0%88"><span class="toc-number">4.1.</span> <span class="toc-text">堆和栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E7%9A%84%E6%80%BB%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.2.</span> <span class="toc-text">代码生成的总体步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Environment"><span class="toc-number">4.3.</span> <span class="toc-text">Environment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E8%A1%A8"><span class="toc-number">4.4.</span> <span class="toc-text">虚表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%94%9F%E6%88%90"><span class="toc-number">4.5.</span> <span class="toc-text">表达式生成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">4.6.</span> <span class="toc-text">函数调用</span></a></li></ol></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/IMG_1335.PNG" data-sizes="auto" alt="Sukuna" class="lazyload">
  <div class="sidebar-author-name">Sukuna</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">29</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">3</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Sukunashinmyoumaru-hust || github || &#34;#191717&#34; itemprop="url" target="_blank" aria-label="github" rel="noopener external nofollow noreferrer"></a>
    </div>
  
    <div class="icon-twitter sidebar-social-icon">
      <a href=https://twitter.com/sukuna_wireless || twitter || &#34;#00aff0&#34; itemprop="url" target="_blank" aria-label="twitter" rel="noopener external nofollow noreferrer"></a>
    </div>
  
    <div class="icon-email sidebar-social-icon">
      <a href=sukuna@hust.edu.cn || envelope || &#34;#55acd5&#34; itemprop="url" target="_blank" aria-label="email" rel="noopener external nofollow noreferrer"></a>
    </div>
  
    <div class="icon-bilibili sidebar-social-icon">
      <a href=https://space.bilibili.com/5595530 itemprop="url" target="_blank" aria-label="bilibili" rel="noopener external nofollow noreferrer"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">首页</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">归档</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">关于</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">友链</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" target="_blank" rel="noopener" href="https://github.com/SukunaShinmyoumaru-hust/Hust-opensource-Xuejie" aria-label="HUST-学解"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">HUST-学解</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/picture" aria-label="赠画感谢"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">赠画感谢</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/source" aria-label="资料下载"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">资料下载</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/travel" aria-label="旅行日志"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">旅行日志</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/gbook" aria-label="Sukuna冬令营"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">Sukuna冬令营</div>
      </div>
    
  
</div>
</div>
      
      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
  
</aside>

          
          <section id="main"><article id="post-stanford-cs143-PA" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <a href="/2024/04/17/stanford-cs143-PA/" class="article-date-link" data-aos="zoom-in">
    <time datetime="2024-04-17T01:11:55.000Z" itemprop="datePublished">2024-04-17</time>
    <time style="display: none;" id="post-update-time">2024-04-17</time>
  </a>
</div>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%9E%E9%AA%8C%E8%AE%B0%E5%BD%95/" data-aos="zoom-in">实验记录</a>
  </div>


    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h1><h2 id="flex用法"><a href="#flex用法" class="headerlink" title="flex用法"></a>flex用法</h2><p>flex可以用于词法分析。一个flex文件可以分成2个部分：引导区和规则区（我起的名）</p>
<p>引导区的内容会原封不动地放到.c文件中。规则区是由若干个规则组成的区域，flex的目的就是为了把规则区的内容进行解释，变成词法分析的.c文件中。（理论：正则表达式转化为NFA，然后再转化为DFA）。规则区的每一个规则由三部分组成<code>&lt;执行状态&gt;&lt;正则式&gt;&lt;匹配规则&gt;</code>。在规则区内部可以执行两种特殊的操作，一种是正则式的宏定义，例如<code>[0-9] DIGIT</code>是将0-9的数字定义成DIGIT。一种是状态声明<code>%START STATE</code>，表示声明了一个新的状态，叫做STATE。最开始的时候的状态叫做INITIAL。</p>
<p>flex执行的逻辑是规则匹配。规则的含义是，在某个执行状态下满足正则式就执行对应的匹配规则。规则匹配的顺序是从上到下的。也就是同时满足AB两种规则，先执行A规则对应的操作，再执行B规则对应的操作。</p>
<p>flex生成的c文件是没有main函数的，main函数需要我们自己实现（本实验已经写好了），flex提供了接口给main函数调用，<code>yylex()</code>负责从文件流中进行读取分析，告诉main函数程序的下一个词是什么类型的。其内容保存在<code>yylval</code>类型的变量中。</p>
<p>再flex内部中，我们可以讲<code>yylval</code>的成员进行赋值以保存相关信息，最原始的匹配信息（比如”abc\n”匹配到了STRING，那么最原始的匹配信息就是”abc\n”）保存在yytext中，yymore的用途是，本次匹配的yytext会保存在下次匹配的yytext前面。</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>CS143的实验要在cool语言上作为基础。对于一个语言来说，注释是必要的，但是对于编译器来说，注释是没必要去理解的。作为编译器的第一环，就需要略掉。cool语言的多行注释的语法是（**），单行注释的语法是–。</p>
<p>首先处理多行注释，按照实验文档中所示，当处于INITIAL状态的时候，遇到了（*，就代表遇到了注释，就要进入注释状态。（这个注释可能是嵌套的，还要保存这是第几层），遇到了*）就是代表推出注释。注释内部所有字符全部忽略。接着处理单行注释，当处于INITIAL状态的时候，遇到了–，就代表遇到了单行注释，就要进入单行注释状态。</p>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>cool语言也支持字符串，对于字符串的定义是从”开始的，当遇到”的符号，就代表进入了字符串状态。</p>
<ul>
<li>对于一个字符串，首先字符串是不能包含’\\‘ ‘&quot;‘ ‘\n’ </li>
<li>字符串的定义是可以换行的，但是换行的时候一定要加\\</li>
<li>最后编译器要对转译字符进行翻译</li>
</ul>
<p>cool语言要求，类型名大写，类型对应的实例是小写的。</p>
<h2 id="flex编译出来的C语言文件"><a href="#flex编译出来的C语言文件" class="headerlink" title="flex编译出来的C语言文件"></a>flex编译出来的C语言文件</h2><p>对flex编译出来的C语言文件进行简单的分析：最前面的一部分是flex自带的东西，对于每个flex文件都有的。还有一部分是flex中引导区的内容，编译的时候会原封不动地放进新生成的.c文件里面。下面是规则区，众所周知，词法分析是用DFA表示的，对于flex文件里面的每一个规则，都对应DFA的一个终止状态，当DFA进入到终止状态之后，就执行我们之前flex文件定义好的动作。下面的一部分是执行DFA操作的代码。</p>
<h1 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h1><h2 id="复习一下！移进和规约"><a href="#复习一下！移进和规约" class="headerlink" title="复习一下！移进和规约"></a>复习一下！移进和规约</h2><p>bison使用LR文法进行分析，分析的基础就基于移进和规约。比如说一个规则S-&gt;abc，当遇到a的时候就移进，遇到b的时候再移进，遇到c的时候再移进，这个时候移进到规则的尾部了。就可以规约成S。移进规约的基础是基于一个状态机的，状态机的每一个状态记录了可能被规约到的规则的集合，移进一个字母就会前往一个新的状态。比如说S-&gt;abc和T-&gt;abd，当遇到a的时候，这两个规则都可能被归约到，这个状态就是S-&gt;a.bc，T-&gt;a.bd。当进入了一个空状态（也就是说一个可能被归约到的规则都没有），就意味着，程序有语法错误。</p>
<h2 id="文法规则"><a href="#文法规则" class="headerlink" title="文法规则"></a>文法规则</h2><p>经过了flex的词法分析，现在进入文法分析的部分。flex将程序分解成了若干个token。这些token被称为终结符。当然与之相对应的是非终结符。这个在编译原理中学过。终结符是以%token定义的，非终结符是以%type定义的。在抽象语法树中，非终结符是语法树的非叶节点，终结符是语法树的叶结点。</p>
<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>对于一个非终止符，需要有属性这一个概念来记录非终止符的相关信息。属性一般可以分为两种，一种叫做继承属性，这种属性一般是抽象语法树的上层结点直接赋予的属性；另外一种是综合属性，综合属性是抽象语法树下面的节点综合计算得来的属性。</p>
<p>对于bison，当执行S-&gt;abc的规约的时候，可以规定一个规约动作，当执行规约操作的时候，规约动作也就一起执行了。在bison的实际应用中，规约动作一般是对S进行综合属性的赋值，和对a，b，c的继承属性的赋值。</p>
<h2 id="是什么"><a href="#是什么" class="headerlink" title="$$是什么"></a>$$是什么</h2><p>在bison的规约操作中，一定会遇到对属性的操作，但是对属性的操作怎么体现在代码上呢？这里使用$开头的元素代指终结符或者非终结符。比如说$$就代替被规约的那个，$1就代表规约的元素的第一个，以此类推。所有元素都代指一个数据类型，在前面的union中定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">%<span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    Boolean boolean;</span><br><span class="line">    Symbol symbol;</span><br><span class="line">    Program program;</span><br><span class="line">    Class_ class_;</span><br><span class="line">    Classes classes;</span><br><span class="line">    Feature feature;</span><br><span class="line">    Features features;</span><br><span class="line">    Formal formal;</span><br><span class="line">    Formals formals;</span><br><span class="line">    Case case_;</span><br><span class="line">    Cases cases;</span><br><span class="line">    Expression expression;</span><br><span class="line">    Expressions expressions;</span><br><span class="line">    <span class="type">char</span> *error_msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中二元组中，前面的具体类型名，后面是代指。比如说定义<code>%type &lt;classes&gt; class_list</code>就代表class_list对应的非终止符，其$类型的变量就是Classes。</p>
<h2 id="规约冲突的化解"><a href="#规约冲突的化解" class="headerlink" title="规约冲突的化解"></a>规约冲突的化解</h2><p>有可能会出现移进-规约和规约-规约的冲突，比如说S-&gt;ab和T-&gt;abc，那读入了ab，是规约呢还是移进呢？这种冲突一般是由语法的二义性所导致的。有一种解决办法是定义结合性。比如说 x op y op z。那么我们可以定义<code>%left op</code>或者<code>%right op</code>。%left指定左相关性（将x与y优先分组）<br>%right指定右相关性（将y与z优先分组）。还有优先级的问题，后定义的要比前面定义的优先级要高。比如说：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%left &#x27;+&#x27; &#x27;-&#x27;</span><br><span class="line">%left &#x27;*&#x27; &#x27;/&#x27;</span><br></pre></td></tr></table></figure>
<p>就代表乘除的优先级要比加减高。</p>
<h2 id="迭代定义的文法"><a href="#迭代定义的文法" class="headerlink" title="迭代定义的文法"></a>迭代定义的文法</h2><p>如果要写一个一种文法，由0个或者若干个1组成的句子，那怎么写呢？一般的方法就是这样：s-&gt;1S|空。在这里也是一样，对于若干个class组成的cool文件，就是classes-&gt;class classes | </p>
<h1 id="语义分析"><a href="#语义分析" class="headerlink" title="语义分析"></a>语义分析</h1><h2 id="前端的review"><a href="#前端的review" class="headerlink" title="前端的review"></a>前端的review</h2><p>编译器设计可以分成两个部分，第一个部分是前端，另外一个部分是后端。前端的部分主要处理和语言相关的操作，比如说C语言，Java或者本课程所提到的cool语言。后端的部分主要处理和目的机有关的内容，比如说把代码生成到x86_linux上等等。现在对前端进行一个preview。</p>
<ul>
<li>词法分析，将源代码分解成若干个token。</li>
<li>语法分析，将若干个token组成一个语法分析树。通过定义好的<code>yyparse</code>读取。</li>
<li>语义分析，分析语法树上的语义单元是否出现语义逻辑错误。通过定义好的<code>yyparse</code>读取。</li>
</ul>
<p>语法分析主要分析语法结构，并不对语义逻辑进行分析，比如说鸡肉吃我，这明显是符合汉语言语法的，但是并不符合标准的语义。</p>
<h2 id="类表"><a href="#类表" class="headerlink" title="类表"></a>类表</h2><p>cool语言是面向对象的语言，代码是由一组类组成的，首先最重要的就是维护类的性质。这里有一个数据结构叫做类表，可以维护类。类表的核心是一张map，这张map记录了类名和类结构体的关系。所有关于类的语义错误都可以被记录下来。</p>
<p>在构建的时候可以进行两方面的检查：</p>
<ul>
<li>名字不能定义成SELF_TYPE（比如说Int之类的）</li>
<li>不能重复定义一个类</li>
<li>必须存在一个叫做Main的类。</li>
</ul>
<p>类表构建完了之后，所有的类的名字都是合法的了，现在要检查类的继承是不是合法的。因为类的继承是不能构成环的，比如说A继承B，那么B不能继承A。完成这种检查的方式很简单，从Main类做一次拓扑排序就好。判断完了这一部分，剩下的只需要检查两个：</p>
<ul>
<li>不能继承整数 String等类</li>
<li>不能继承一个不存在的类</li>
</ul>
<p>当然不会做拓扑排序的话还有一种方法，就是遍历每个类，对每个类进行溯源，直到Object，如果遇到和这个类一样的就报错。</p>
<h2 id="方法表"><a href="#方法表" class="headerlink" title="方法表"></a>方法表</h2><p>现在把视角往下放，进入到方法表中，现在我们对每一个类构建一个方法表，<code>static std::map&lt;Symbol, MethodTable&gt; methodtables;</code>其中一个MethodTable是一个<code>typedef SymbolTable&lt;Symbol, method_class&gt; MethodTable;</code>我们发现这就是一个符号表！</p>
<p>正确的，对语义操作到这里我们发现，其实所有的表都是符号表！符号表记录了每一个区域的所有定义的符号的信息。编译原理课上其实学过，一个作用域就会有一个符号表，当编译器想要搜索一个符号究竟是啥意思的时候，就会从符号表上进行搜索。这里又提到了作用域，其实在编译器的实践中，作用域会体现在符号表上的层数上，比如说一个类是第一层，类里面的方法定义是第二层，等等。当语义分析来到了这一层之后，就要新建一个这一层的符号表。当语义分析脱离了这一层之后，这一层定义的符号表就没有用了。其实这就像个stack。</p>
<p>简单介绍以下本项目的符号表，本符号表通过一个叫做<code>Scope</code>的东东来进行作用域管理，当来一个新的作用域的时候，新建一个，当离开一个作用的时候，销毁一个，当要在该作用域加一个元素的时候，就可以使用<code>Scope(scope,new_element)</code>来添加。原理和栈一样！</p>
<p>现在已经对每个类都组织好了符号表，每个类都记录好所含的成员或者方法。组织的方法就是对类的Feature进行读取，这个Feature已经在语法分析的时候已经做好了，和上面的一样，还是对这个符号表进行检查。检查需要检查重载的性质。父类定义了个方法，子类的同名方法必须要和父类同名方法一致。</p>
<p>首先第一个问题，就是怎么获取到父类？这里使用之前构建好的类表的<code>EetInheritance</code>，代码浅显易懂，就是回溯！</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::list&lt;Symbol&gt; <span class="title">ClassTable::GetInheritancePath</span><span class="params">(Symbol type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (type == SELF_TYPE) &#123;</span><br><span class="line">        type = curr_class-&gt;<span class="built_in">GetName</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::list&lt;Symbol&gt; path;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// note that Object&#x27;s father is No_class</span></span><br><span class="line">    <span class="keyword">for</span> (; type != No_class; type = m_classes[type]-&gt;<span class="built_in">GetParent</span>()) &#123;</span><br><span class="line">        path.<span class="built_in">push_front</span>(type);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二个问题，就是知道了父类，怎么指导父类有没有这个元素呢？可以自己实现一个<code>lookup</code>函数，因为父类也已经构建好了一组方法表，找就完事了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DAT * <span class="title">lookup</span><span class="params">(SYM s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">for</span>(ScopeList *i = tbl; i != <span class="literal">NULL</span>; i=i-&gt;<span class="built_in">tl</span>()) &#123;</span><br><span class="line"><span class="keyword">for</span>( Scope *j = i-&gt;<span class="built_in">hd</span>(); j != <span class="literal">NULL</span>; j = j-&gt;<span class="built_in">tl</span>()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s == j-&gt;<span class="built_in">hd</span>()-&gt;<span class="built_in">get_id</span>()) &#123;</span><br><span class="line"> <span class="keyword">return</span> (j-&gt;<span class="built_in">hd</span>()-&gt;<span class="built_in">get_info</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面贴出来的是人家写好的lookup，照着用就好了。其实也只是遍历而已。</p>
<p>最后一个问题就是怎么判断函数参数的个数，其实早在语法分析的时候已经把所有的参数信息全部放到<code>Formal</code>这里面去了。</p>
<h2 id="属性表"><a href="#属性表" class="headerlink" title="属性表"></a>属性表</h2><p>本项目维护了一个属性表，这个属性表就是一个符号表，全局，仅此一个。这个符号表帮助我们进行最后的语义检查。</p>
<p>程序的总的框架还是类，对每个类进行分析。这里我们首先引入一个问题。类的继承构成Scope的迭代吗？其实构成的。首先想一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">        <span class="type">int</span> b；</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// can I get the value of a here? which a? What about b?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在第一层括号是访问不到第二层的a的内容的。父类的作用域中无法访问到子类的元素，但是子类的作用域可以访问父类的元素，还可以重写。那么子类的作用域是不是像第二层的，父类的作用域是不是像第一层的！能理解这一点可以加深对作用域的思考。</p>
<p>好话说回属性表，组织好一个属性表之后，就需要依据属性表的元素进行分析了对类里面每个元素进行分析了！</p>
<p>check分成两部分，一部分是方法，一部分是属性。</p>
<p>首先谈谈方法吧，首先，方法内部也会存在大量的作用域嵌套！所以更新作用域表是很有必要的。因为进入了一个新方法的分析，就需要打开一个作用域。其次，方法的分析分为两部分，一个是对参数的分析，一个是对内容的分析。参数是一个参数表，需要对参数表的名字和类型进行分析。内容本质上，就是一个表达式。我们需要分析表达式的返回类型是不是和方法定义的匹配。</p>
<p>接着谈谈属性吧，一般来说，属性后面需要添加一个初始化语句，我们还需要对这个初始化语句进行分析，看看其类型。</p>
<h2 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h2><p>无论是上面的方法表达式和初始化语句，都是表达式，对表达式的类型分析是非常有必要的，因为语言都是由一组组的表达式构成的，表达式的类型非常丰富，需要考虑到各种各样的表达式的构成。这一部分不表。</p>
<h1 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h1><p>终于结束了前端的工作，来到了后端的工作，在前端的时候，我们构建了一个语法树，根据语法树的信息判断了语义信息，验证了语义信息的正确性，现在我们根据这个语法树和相关的语义信息，进行代码生成。</p>
<h2 id="堆和栈"><a href="#堆和栈" class="headerlink" title="堆和栈"></a>堆和栈</h2><p>堆和栈是从大一学习C语言开始就老生长谈的一个话题了，简单的说，堆和栈是存放数据的两个区域。堆呢，一般负责存放静态的，不咋变化的数据。栈呢，一般存放动态的，一直在变的数据。针对数据的相关性质，可以对数据分配不同的存放模式。对于堆中的数据，我们一般可以进行简单的管理，对于栈中的数据，我们可以临时使用一个sp寄存器当作指针进行访存。</p>
<h2 id="代码生成的总体步骤"><a href="#代码生成的总体步骤" class="headerlink" title="代码生成的总体步骤"></a>代码生成的总体步骤</h2><ul>
<li>类表构建：还是和PA4一样的思路，对于类，首先构建一个类表来记录相关的信息。这个类表记录了系统已有的标准类和用户自己定义的类的一切信息。</li>
<li>全局变量：构建好了类的信息之后，第一步是构建全局变量。这一部分的操作是固定的，根据MIPS的定义，首先要建立基本类的定义，比如说Str，Int等类。以标签的形式存在于汇编语句中。</li>
<li>定义GC：方便内存管理</li>
<li>常量：记录各种各样的常量值，放在最前面。因为常量的值是不可以更改的。</li>
<li>类名：记录每个类及其子类。初始化相关的类。</li>
<li>构建虚表：将每个类的方法的入口地址记录下来。</li>
<li>原型对象构建：所有的类都会从一个原型对象继承属性和方法。</li>
<li>类的构造函数构建：</li>
<li>类的方法构建:</li>
</ul>
<h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><p>这个Environment其实就是各种变量存放的位置，对于一个变量a，我们可以在编译的时候对其进行空间的分配。由于MIPS（RISC-V）也一样的访存是以寄存器+偏移的形式进行间接访问管理的。所以说就在这里记录变量的地址了。那函数的入口地址怎么记录呢？</p>
<h2 id="虚表"><a href="#虚表" class="headerlink" title="虚表"></a>虚表</h2><p>学过C++的应该知道虚函数，在这里，每一个method可以认为是一个虚函数。在调用虚函数的入口地址的时候，是需要调用晚期绑定类型对应的入口地址，这时候需要查找虚函数的入口地址，然后构造汇编指令。函只在C++中，如果要有virtual，我们就需要把它添加进vTable。并且每个类(而不是类实例)都有自己的虚表，因此vTable就变成了vTables。虚表存放的位置一般存放在模块的常量段中，从始至终都只有一份。</p>
<p>对于cool语言来说，也是需要虚表，我们默认所有函数，都是虚函数。所以说构建一个虚表是很有必要的。在实践中，我们使用<code>code_dispatchTabs</code>函数来记录虚函数的地址，每一个表项由类名，方法名和地址构成</p>
<h2 id="表达式生成"><a href="#表达式生成" class="headerlink" title="表达式生成"></a>表达式生成</h2><p>分配了数据的位置，那可以进行代码的生成了。</p>
<p>在CS143的课程中，提到了表达式的生成。比如说有个表达式，a+b，那么我们可以递归的来计算，首先将a的值放到a0寄存器中，然后把a0寄存器的值放到栈顶，更新栈。接着把b的值计算出来放到a0，取栈顶的值放到t1，最后计算a0+t1。这是一个简单的表达式计算的方法。</p>
<p>这里体验了CT和RT的联动，CT指的是编译时所做的操作，RT指的是运行时所做的操作。上面说明的是CT的操作，而RT的操作就被抽象成了a的值的计算了！这样可以实现多态。</p>
<h2 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h2><p>在讲函数的调用之前，首先要明确一个概念，叫做caller和callee，假如说在main函数调用了用户自己写的函数a，那么main就是caller，callee就是a。Caller-saved register（又名易失性寄存器AKA volatile registers, or call-clobbered）用于保存不需要在各个调用之间保留的临时数据。Callee-saved register（又称非易失性寄存器AKA non-volatile registers, or call-preserved）用于保存应在每次调用中保留的长寿命值。当调用者进行过程调用时，可以期望这些寄存器在被调用者返回后将保持相同的值，这使被调用者有责任在返回调用者之前保存它们并恢复它们。</p>
<p>学过汇编的都知道，在进行函数调用的时候，执行过程是这样的：</p>
<ul>
<li>caller将所有参数进行入栈</li>
<li>调用函数（j指令）</li>
<li>callee保存caller的fp</li>
<li>callee设置fp为sp</li>
<li>callee保存其他callee-save寄存器</li>
<li>callee将a0保存在s0中</li>
<li>callee执行函数体</li>
<li>callee回复之前保存的寄存器</li>
<li>恢复栈帧为调用前的状态</li>
<li>跳转ra保存的返回地址</li>
</ul>

      
    </div>
    <footer class="article-footer">
      
        <blockquote class="article-copyright">
    <p><strong>本文作者：</strong>Sukuna @ Suwa shrine</p>
    <p><strong>本文链接：</strong><a href="https://sukunashinmyoumaru-hust.github.io/2024/04/17/stanford-cs143-PA/">https://sukunashinmyoumaru-hust.github.io/2024/04/17/stanford-cs143-PA/</a></p>
    
    
    
    <p><strong>本文版权：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><span class="icon-creative-commons"></span>BY-NC-SA</a> 许可协议。转载请注明出处！</p>
    <span class="icon-creative-commons article-copyright-bg"></span>
  </blockquote>
      
      
      
        <a data-aos="zoom-in" href="/2024/04/17/stanford-cs143-PA/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2024/04/17/stanford-cs143-PA/" itemprop="commentCount"></span>
          留言
        </a>
      
      
      
      
      
      

    </footer>
  </div>
  
  <nav id="article-nav" data-aos="fade-up">
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="https://s3.bmp.ovh/imgs/2024/06/17/7d2279310f1bb2f7.jpg" data-sizes="auto" alt="MIT_6.824:PA1-MapReduce" class="lazyload">
          
        
        <a href="/2024/04/19/mit-6-824-mr/"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
          
            MIT_6.824:PA1-MapReduce
          
        </h3>
      </div>
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="https://s3.bmp.ovh/imgs/2024/06/17/f841728a51c3ae78.jpg" data-sizes="auto" alt="南大pa" class="lazyload">
        
      
      <a href="/2023/09/13/nju-pa/"></a>
      <div class="article-nav-caption">后一篇</div>
      <h3 class="article-nav-title">
        
          南大pa
        
      </h3>
    </div>
    
  </nav>


</article>

  <section id="comments" class="vcomment" data-aos="fade-up"></section>






</section>
          
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-autoplay="false"></div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      2020-2025
      <span class="footer-info-sep rotate"></span>
      Sukuna
    </div>
    
      <div>
        基于&nbsp;<a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="noopener external nofollow noreferrer" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        252.8k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        17:19
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">总访客量&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
  
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">词法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flex%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">flex用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">1.2.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.3.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex%E7%BC%96%E8%AF%91%E5%87%BA%E6%9D%A5%E7%9A%84C%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">flex编译出来的C语言文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">语法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0%E4%B8%80%E4%B8%8B%EF%BC%81%E7%A7%BB%E8%BF%9B%E5%92%8C%E8%A7%84%E7%BA%A6"><span class="toc-number">2.1.</span> <span class="toc-text">复习一下！移进和规约</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%B3%95%E8%A7%84%E5%88%99"><span class="toc-number">2.2.</span> <span class="toc-text">文法规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.4.</span> <span class="toc-text">$$是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%84%E7%BA%A6%E5%86%B2%E7%AA%81%E7%9A%84%E5%8C%96%E8%A7%A3"><span class="toc-number">2.5.</span> <span class="toc-text">规约冲突的化解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%AE%9A%E4%B9%89%E7%9A%84%E6%96%87%E6%B3%95"><span class="toc-number">2.6.</span> <span class="toc-text">迭代定义的文法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%AD%E4%B9%89%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">语义分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%9A%84review"><span class="toc-number">3.1.</span> <span class="toc-text">前端的review</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E8%A1%A8"><span class="toc-number">3.2.</span> <span class="toc-text">类表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%A1%A8"><span class="toc-number">3.3.</span> <span class="toc-text">方法表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%A1%A8"><span class="toc-number">3.4.</span> <span class="toc-text">属性表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">3.5.</span> <span class="toc-text">表达式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-number">4.</span> <span class="toc-text">代码生成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%92%8C%E6%A0%88"><span class="toc-number">4.1.</span> <span class="toc-text">堆和栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E7%9A%84%E6%80%BB%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.2.</span> <span class="toc-text">代码生成的总体步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Environment"><span class="toc-number">4.3.</span> <span class="toc-text">Environment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E8%A1%A8"><span class="toc-number">4.4.</span> <span class="toc-text">虚表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%94%9F%E6%88%90"><span class="toc-number">4.5.</span> <span class="toc-text">表达式生成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">4.6.</span> <span class="toc-text">函数调用</span></a></li></ol></li></ol>
      
  </div>
</div>
</div>
      <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/IMG_1335.PNG" data-sizes="auto" alt="Sukuna" class="lazyload">
  <div class="sidebar-author-name">Sukuna</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">29</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">3</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Sukunashinmyoumaru-hust || github || &#34;#191717&#34; itemprop="url" target="_blank" aria-label="github" rel="noopener external nofollow noreferrer"></a>
    </div>
  
    <div class="icon-twitter sidebar-social-icon">
      <a href=https://twitter.com/sukuna_wireless || twitter || &#34;#00aff0&#34; itemprop="url" target="_blank" aria-label="twitter" rel="noopener external nofollow noreferrer"></a>
    </div>
  
    <div class="icon-email sidebar-social-icon">
      <a href=sukuna@hust.edu.cn || envelope || &#34;#55acd5&#34; itemprop="url" target="_blank" aria-label="email" rel="noopener external nofollow noreferrer"></a>
    </div>
  
    <div class="icon-bilibili sidebar-social-icon">
      <a href=https://space.bilibili.com/5595530 itemprop="url" target="_blank" aria-label="bilibili" rel="noopener external nofollow noreferrer"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">首页</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">归档</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">关于</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">友链</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" target="_blank" rel="noopener" href="https://github.com/SukunaShinmyoumaru-hust/Hust-opensource-Xuejie" aria-label="HUST-学解"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">HUST-学解</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/picture" aria-label="赠画感谢"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">赠画感谢</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/source" aria-label="资料下载"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">资料下载</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/travel" aria-label="旅行日志"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">旅行日志</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/gbook" aria-label="Sukuna冬令营"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">Sukuna冬令营</div>
      </div>
    
  
</div>
</div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin="anonymous"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>







  
<script src="https://npm.webcache.cn/mouse-firework@0.0.6/dist/index.umd.js" integrity="sha384-vkGvf25gm1C1PbcoD5dNfc137HzNL&#x2F;hr1RKA5HniJOaawtvUmH5lTVFgFAruE9Ge" crossorigin="anonymous"></script>

  <script>
    window.firework && window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["#ff0000"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>



  
<script src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js" integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE&#x2F;jMSCxD+jAPU55x&#x2F;jj3wlf" crossorigin="anonymous"></script>

  <script>
    function loadScripts(scripts, index) {
      if (index < scripts.length) {
        const script = scripts[index];
        const src = script.getAttribute('src');

        const loadScript = (scriptContent) => {
          const scriptElement = document.createElement('script');
          if (script.type) {
            scriptElement.type = script.type;
          }
          scriptElement.text = scriptContent;
          document.head.appendChild(scriptElement);
          loadScripts(scripts, index + 1);
        }

        if (src) {
          fetch(src)
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
              }
              return response.text();
            })
            .then(scriptContent => {
              loadScript(scriptContent);
            })
            .catch(error => {
              console.error('Failed to load script:', src, error);
            });
        } else {
          loadScript(script.text);
        }
      }
    }
    window.Pjax && new window.Pjax({
      selectors: [
        "#header img",
        "#header picture",
        "head title",
        "#header-title",
        "#subtitle-wrap",
        "#content",
        '#mobile-nav',
        '#lazy-script'
      ],
      switches: {
        "#header-title": Pjax.switches.outerHTML,
        "#subtitle-wrap": Pjax.switches.outerHTML,
        "#content": function(oldEl, newEl) {
          const scripts = [...newEl.querySelectorAll('script')];
          loadScripts(scripts, 0);
          oldEl.outerHTML = newEl.outerHTML
          this.onSwitch()
        },
        "#mobile-nav": Pjax.switches.outerHTML,
        '#lazy-script': function(oldEl, newEl) {
          const scripts = [...newEl.querySelectorAll('script')];
          loadScripts(scripts, 0);
          oldEl.innerHTML = newEl.innerHTML
          this.onSwitch()
        },
      },
      cacheBust: false
    })
  </script>
  
<script src="/js/pjax.js"></script>




  <script>
    function initLive2d() {
      live2d.init("https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/", {themeTipsPath: ""});
    }
  </script>
  
<script src="https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/js/live2d-autoload.js" onload="initLive2d &amp;&amp; initLive2d()" async></script>





<div id="lazy-script">
  <div>
    
    
      
        
<script src="/js/insert_highlight.js" data-pjax></script>

      
    
    
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js", "sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/")).default;
        
        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      
  
<script src="https://npm.webcache.cn/valine@1.5.1/dist/Valine.min.js" integrity="sha384-3ma91AExDeMAZ1rjTjaP8V2A2obQE+s5ltKRwYlwdpArz9xVbp0tF3b0VV2ACNPn" crossorigin="anonymous" data-pjax></script>

  <script data-pjax>
    var GUEST_INFO = ['nick', 'mail', 'link'];
    var guest_info = 'SukunaFans'.split(',').filter((item) => {
      return GUEST_INFO.indexOf(item) > -1
    });
    var recordIP = JSON.parse('true');
    var highlight = JSON.parse('true');
    var visitor = JSON.parse('false');

    new Valine({
      el: '.vcomment',
      appId: "xR5C19oD9KiPnawzBUJNSD64-gzGzoHsz",
      appKey: "BuHN9ATTBOcwMxGPy9IxuI8b",
      placeholder: "留下你的留言吧",
      pageSize: '10',
      avatar: 'mp',
      lang: 'zh-cn',
      recordIP: recordIP,
      highlight: highlight,
      visitor: visitor,
      requiredFields: guest_info,
      path: window.location.pathname
    });
  </script>









    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '1.0.0' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  



  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin="anonymous" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>



  
    
<script src="https://npm.webcache.cn/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha384-Wuix6BuhrWbjDBs24bXrjf4ZQ5aFeFWBuKkFekO2t8xFU0iNaLQfp2K6&#x2F;1Nxveei" crossorigin="anonymous" defer data-pjax></script>

    <script data-pjax>
      window.MathJax = {"tex":{"tags":"ams","useLabelIds":true,"inlineMath":[["$","$"],["\\\\(","\\\\)"]],"displayMath":[["$$","$$"],["\\\\[","\\\\]"]],"processEscapes":true,"processEnvironments":true,"autoload":{"color":[],"colorv2":["color"]},"packages":{"[+]":["noerrors"]}},"options":{"skipHtmlTags":["script","noscript","style","textarea","pre","code"],"ignoreHtmlClass":"tex2jax_ignore","processHtmlClass":"tex2jax_process"},"loader":{"load":["input/asciimath","[tex]/noerrors"]}};
    </script>
  


  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
  </html>

